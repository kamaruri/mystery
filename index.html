<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>その一歩を、信じてほしい | 火星野つばさ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=M+PLUS+Rounded+1c&family=Zen+Kaku+Gothic+Antique&display=swap" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@500&family=Share+Tech+Mono&family=Shippori+Mincho+B1&family=M+PLUS+Rounded+1c&family=Kosugi+Maru&family=Zen+Old+Mincho&family=Noto+Serif+JP&family=IBM+Plex+Sans+JP&display=swap');

    :root {
      --primary: #1a4d2e;
      --accent: #e60039;
      --bg: #f4f4f4;
      --light: #ffffff;
    }

    body {
      margin: 0;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.theme-news {
      background: #ffffff;
      color: #000;
      font-family: 'Bebas Neue', sans-serif;
      text-transform: uppercase;
    }

    body.theme-schedule {
      background: #001F3F;
      color: #ffffff;
      font-family: 'Share Tech Mono', monospace;
    }

    body.theme-players {
      background: #faf3e0;
      color: #333;
      font-family: 'Noto Serif JP', serif;
    }

    body.theme-ticket {
      background: linear-gradient(to right, #111, #333);
      color: #fff;
      font-family: 'Orbitron', sans-serif;
    }

    body.theme-stadium {
      background: url('https://source.unsplash.com/1600x900/?stadium') no-repeat center center fixed;
      background-size: cover;
      color: white;
      font-family: 'Shippori Mincho B1', serif;
    }

    body.theme-fan {
      background: #fff0f5;
      color: #333;
      font-family: 'M PLUS Rounded 1c', sans-serif;
    }

    body.theme-academy {
      background: #f5f9fd;
      color: #222;
      font-family: 'IBM Plex Sans JP', sans-serif;
    }

    body.theme-school {
      background: #ffffe0;
      color: #222;
      font-family: 'Kosugi Maru', sans-serif;
    }

    body.theme-town {
      background: linear-gradient(to bottom, #ffffff 70%, #e0e0ff);
      color: #222;
      font-family: 'Zen Old Mincho', serif;
      text-align: center;
    }

    header {
      background-color: var(--primary);
      color: var(--light);
      padding: 1.3rem;
      text-align: center;
      font-family: 'M PLUS Rounded 1c', sans-serif;
      font-size: 1.3rem;
      font-weight: bold;
    }

    nav {
      display: flex;
      overflow-x: auto;
      background-color: #000;
      border-bottom: 2px solid var(--accent);
    }

nav button {
  padding: 1.2rem 2.4rem
  font-size: 24px;
  font-weight: bold;
  color: white;
  background: none;
  border: none;
  cursor: pointer;
  white-space: normal;
  text-align: center;
  display: inline-block;  /* ← flexをやめて自動幅に */
  min-width: max-content; /* ← 内容の最長行に幅を合わせる */
  align-items: center;
  justify-content: center;
}

     /* タブの背景色を順番で指定（赤、橙、黄、緑、青、藍、紫） */
 nav button:nth-child(1) { background-color: rgba(255, 0, 0, 0.3); }     /* 赤 */
 nav button:nth-child(2) { background-color: rgba(255, 165, 0, 0.3); }   /* オレンジ */
 nav button:nth-child(3) { background-color: rgba(255, 255, 0, 0.3); }   /* 黄 */
 nav button:nth-child(4) { background-color: rgba(0, 128, 0, 0.3); }     /* 緑 */
 nav button:nth-child(5) { background-color: rgba(0, 0, 255, 0.3); }     /* 青 */
 nav button:nth-child(6) { background-color: rgba(75, 0, 130, 0.3); }    /* 藍 */
 nav button:nth-child(7) { background-color: rgba(128, 0, 128, 0.3); }   /* 紫 */
 nav button:nth-child(8) { background-color: rgba(199, 21, 133, 0.3); }  /* お問い合わせ（赤紫系） */

 /* アクティブ時は透明度を下げて強調表示 */
 nav button.active:nth-child(1) { background-color: rgba(255, 0, 0, 0.8); }
 nav button.active:nth-child(2) { background-color: rgba(255, 165, 0, 0.8); }
 nav button.active:nth-child(3) { background-color: rgba(255, 255, 0, 0.8); color: black; }
 nav button.active:nth-child(4) { background-color: rgba(0, 128, 0, 0.8); }
 nav button.active:nth-child(5) { background-color: rgba(0, 0, 255, 0.8); }
 nav button.active:nth-child(6) { background-color: rgba(75, 0, 130, 0.8); }
 nav button.active:nth-child(7) { background-color: rgba(128, 0, 128, 0.8); }
 nav button.active:nth-child(8) { background-color: rgba(199, 21, 133, 0.8); }

    
   nav button:hover {
  filter: brightness(1.2);  /* 明るくなる */
  transform: scale(1.02);   /* 少し大きくなる */
  transition: all 0.2s ease;
}

    
    nav button.active {
      background-color: var(--accent);
    }

    .content-section {
      display: none;
      padding: 2rem;
      animation: fadein 0.4s;
    }

    .content-section.active {
      display: block;
    }

    @keyframes fadein {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .interview-image {
      text-align: center;
      margin: 2rem 0;
      position: relative;
    }

    #kaseno-img {
      width: 90%;
      border-radius: 16px;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }

    #popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 1rem 2rem;
      border-radius: 10px;
      display: none;
      z-index: 1000;
      text-align: center;
    }

    #chatPopup {
  display: none;
  position: fixed;
  top: 10%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 500px;
  background: #ffffff;
  border: 2px solid #444;
  border-radius: 16px;
  padding: 1.5rem;
  z-index: 1000;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  font-family: "Noto Sans JP", sans-serif;
  animation: fadein 0.3s ease-in-out;
}

/* ボタン類の共通設定 */
#chatPopup button {
  display: inline-block;
  background: #f2f2f2;
  color: #333;
  font-size: 1rem;
  padding: 0.5em 1em;
  margin: 0.3em 0.5em;
  border: 1px solid #999;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}
#chatPopup button:hover {
  background: #dcefff;
  border-color: #66aaff;
}

/* 特別な「進む」ボタン用 */
#chatPopup button[style*="gold"] {
  color: #fff;
  font-weight: bold;
  background: linear-gradient(to right, #ffcc00, #ff8800);
  box-shadow: 0 0 10px rgba(255, 200, 50, 0.6);
  border: none;
}

/* テキスト部分 */
#chatBox p {
  line-height: 1.8;
  font-size: 1rem;
  color: #222;
  margin-bottom: 1rem;
}

/* 閉じるボタン */
#chatPopup > div:first-child button {
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: #999;
}
#chatPopup > div:first-child button:hover {
  color: #333;
}

/* フェードイン効果 */
@keyframes fadein {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

#chatBox {
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.chat-bubble {
  max-width: 85%;
  padding: 1rem;
  border-radius: 15px;
  font-size: 1rem;
  line-height: 1.6;
  word-wrap: break-word;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.chat-bubble.bot {
  background: #e8f0ff;
  align-self: flex-start;
  border-top-left-radius: 0;
}

.chat-bubble.user {
  background: #fff7e0;
  align-self: flex-end;
  text-align: right;
  border-top-right-radius: 0;
}

.chat-bubble.user button {
  background: #ffcf91;
  border: none;
  padding: 0.6em 1em;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.2s ease-in-out;
}

.chat-bubble.user button:hover {
  background: #ffc060;
}

</style>
</head>
<body>
  <header>アイナック神戸応援サイト_謎解き</header>
  <nav id="tab-buttons">
    <button class="active" data-tab="news">Report<br>ニュース</button>
    <button data-tab="players">Athlete<br>選手・スタッフ</button>
    <button data-tab="ticket">Invite<br>チケット</button>
    <button data-tab="school">Next<br>スクール</button>
    <button data-tab="stadium">Base<br>スタジアム</button>
    <button data-tab="fan">On-line<br>ファン活動</button>
    <button data-tab="inquiry">Window<br>お問い合わせ</button>
  </nav>

  <div id="news" class="content-section active">
    <h2 style="font-size: 1.5rem; border-left: 6px solid crimson; padding-left: 0.5rem; letter-spacing: 2px;">🚨 NEWS</h2>
    <article style="max-width: 700px; margin: 2rem auto; font-size: 1.1rem; line-height: 2;">
      <p style="border-left: 4px solid #ccc; padding-left: 1rem;">【2025.06.01】火星野つばさ、新たな挑戦を宣言。クラブ「レオネッサ・ギャラクシア」は、キャプテン火星野つばさの引退発表とともに、次代への布石としてアカデミー強化方針を発表。</p>
      <p style="font-style: italic; text-align: center; margin-top: 1rem;">『元気はわいてくるぞ！』</p>
      <p>この決め台詞に、大いに盛り上がり、多くのファンが涙した。</p>
    </article>
    <div class="interview-image">
      <img id="kaseno-img" src="https://github.com/kamaruri/public-assets/blob/main/%E8%83%8C%E4%B8%AD%E3%82%92%E5%90%91%E3%81%91%E3%81%9F%E9%81%B8%E6%89%8B%E3%81%A7%E5%B7%A6%E5%8F%B3%E3%81%AB%E8%83%8C%E6%99%AF%E3%81%82%E3%82%8Apng.jpg?raw=true" alt="火星野つばさの後ろ姿">
      <div id="popup">背中を押してくれてありがとう！<br>ファイトと送信しよう！</div>
    </div>
  </div>

  <div id="players" class="content-section">
    <h2>選手・スタッフ</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 2rem;">
      <div style="flex: 1; min-width: 250px; background: #fff; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); padding: 1rem;">
        <h3>#100 火星野つばさ（FW／キャプテン）</h3>
        <p>
          ピッチでは絶対的エース。試合中の無言の背中は「パスをくれ！」の合図。2024シーズンは全試合出場中。勇気あふれるプレーからニックネームは「ライオン」🦁。決め台詞の通り、観客はプレーにいつも沸いている。
        </p>
      </div>
      <div style="flex: 1; min-width: 250px; background: #fff; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); padding: 1rem;">
        <h3>小惑星ジロー（監督）</h3>
        <p>
          火星代表として数々の国際大会を経験した元MF。戦術設計の鬼として知られ、グラウンド外でも選手との距離が近く、信頼は厚い。
        </p>
      </div>
      <div style="flex: 1 100%; margin-top: 1rem;">
        <p>
          その他、チームには未来の主役たる若手MF「アステロイド・マコト」や、DF「ルナ・シールド」など、個性豊かな架空選手たちが在籍している。
        </p>
      </div>
    </div>
  </div>

  <div id="ticket" class="content-section">
    <h2 style="font-size: 2.5rem; border-bottom: 2px dashed #ffcc00; padding-bottom: 0.5rem;">🎟 チケット情報</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 2rem;">
      <div style="flex: 1; min-width: 200px; background: #222; padding: 1.5rem; border-radius: 12px; box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);">
        <h3 style="font-size: 1.2rem; color: #ffcc00;">一般チケット</h3>
        <p>💰 3,000円</p>
      </div>
      <div style="flex: 1; min-width: 200px; background: #222; padding: 1.5rem; border-radius: 12px; box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);">
        <h3 style="font-size: 1.2rem; color: #00ccff;">U-18割引</h3>
        <p>👶 1,000円</p>
      </div>
      <div style="flex: 1; min-width: 200px; background: #222; padding: 1.5rem; border-radius: 12px; box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);">
        <h3 style="font-size: 1.2rem; color: #00ff99;">火星住民</h3>
        <p>🪐 無料（要身分証）</p>
      </div>
    </div>
    <div style="margin-top: 2rem; font-size: 1rem;">
      <p>📍 <strong>購入方法：</strong>公式サイトのチケットページ または 宇宙便航線窓口にてお求めいただけます。</p>
      <p>💺 <strong>座席種類：</strong>ピッチサイド・オーロラビュー、コメット席、バックスタンド・フリープラン席など多彩にご用意。</p>
      <p>🛑 <strong>注意：</strong> 惑星間移動の際は別途交通手段をご用意ください。</p>
    </div>
  </div>

  <div id="stadium" class="content-section">
  <h2 style="font-size: 2rem; text-align: left; color: #222;">スタジアム紹介</h2>
  <div style="line-height: 2; font-size: 1.2rem; color: #333;">
    🏟<strong>火星陸ドーム</strong><br>
    火星赤道直下に設置された全天候型スタジアム。最大収容人員は8万人。<br>
    ピッチは天然芝型ソーラーフィールドを採用し、日照の変化にも柔軟に対応。観客席には空中浮遊型リクライニングチェア、トンネル内にはAIドリンクスタンドを配置。<br><br>
    🌐<strong>アクセス：</strong><br>
    ・オリュンポスモンサブシャトル駅より徒歩15分<br>
    ・軌道エレベータ経由での地球連結ルートあり
  </div>
</div>

  <div id="fan" class="content-section">
    <h2>ファンゾーン</h2>
    <p>
      🎉<strong>ファン交流イベント：</strong><br>
      火星陸ドーム前広場にて、毎試合前に「ファンギャザリング」開催！火星野選手の等身大ホログラムと写真が撮れるフォトブース、選手のメッセージ動画が流れるパビリオンも大好評。<br><br>

      🛍<strong>グッズ販売：</strong><br>
      火星野Tシャツ、レプリカユニフォーム、宇宙限定トレカセットなど多数ラインアップ。<br><br>

      📱<strong>SNS連携企画：</strong><br>
      ハッシュタグ「#火星野へ届け」で応援メッセージを投稿すると、試合中にスタジアムビジョンに掲載されるチャンスも！
    </p>
    <p>
      🌌<strong>プレミアム会員制度：</strong><br>
      月額500火星ドルで、試合後の選手インタビュー視聴、限定グッズの先行購入、火星野選手による直筆メッセージ入りカードなどが受け取れるプレミアム体験が可能です。
    </p>
  </div>
  
  <div id="school" class="content-section">
    <h2>スクール</h2>
    <p>
      🎓<strong>サテライト・ジュニアスクール</strong><br>
      火星と地球をつなぐ双方向型スクール。年中〜中学生を対象に、サッカーの楽しさを通じて協調性・思考力を育てることを目的としています。<br><br>

      🌞<strong>毎週の活動：</strong><br>
      土曜午前：火星校グラウンドにて実技指導／地球校はVRトレーニング<br>
      水曜夜：ビデオ講義＋Q&Aタイム（Zoom+AI分析）<br><br>

      📧<strong>体験受付中！</strong> 初回は無料、メールフォームより申し込み可能です。
    </p>
    <p>
      🛡<strong>保護者向けセミナー：</strong><br>
      毎月第3日曜には、地球・火星それぞれで保護者対象のスポーツ教育セミナーを開催。火星野選手自身が語る「挫折と再起」の講話が人気です。
    </p>
  </div>

<div id="inquiry" class="content-section">
  <h2 style="font-size: 2rem; margin-bottom: 1rem;">📩 お問い合わせチャット</h2>

  <p style="max-width: 700px; margin: auto; line-height: 2; font-size: 1rem;">
    こちらは <strong>AIチャット形式のお問い合わせ窓口</strong>です。チャットボタンを押すと、よくあるご質問に対して即時にご案内いたします。  
    <br><br>
    現在、<strong>電話による個別対応は休止</strong>しております。<br>
    ※専用フォームからのメールを通じたご案内を優先しております。
  </p>

  <div style="max-width: 700px; margin: 2rem auto; background: #fff8dc; padding: 1rem 1.5rem; border-left: 6px solid #ffa500; border-radius: 10px; font-size: 0.95rem; line-height: 1.8;">
    <strong>⚠️ ご利用上の注意</strong>
    <ul style="padding-left: 1.2rem; margin-top: 0.5rem;">
      <li>AIによる自動応答のため、内容によっては正確なご案内が難しい場合があります。</li>
      <li>緊急のご連絡や個人情報を含む内容には対応できません。</li>
      <li>操作がうまくいかない場合は、時間をおいて再度お試しください。</li>
      <li>深夜帯（22時～翌朝6時）でも対応は可能ですが、AIのみでのご案内です。</li>
    </ul>
  </div>

  <p style="max-width: 700px; margin: auto; font-size: 1rem; text-align: center; margin-bottom: 1.5rem; font-style: italic;">
    「なんとなく不安…」そんな時も、まずは気軽にボタンを押してみてください。<br>
    私たちは、あなたの一歩を応援します。
  </p>

  <div style="text-align: center;">
    <button onclick="startChat()" style="padding: 0.8em 1.5em; font-size: 1.1rem; background: linear-gradient(to right, #ffd27f, #ffc107); border: none; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); cursor: pointer;">
      🗨️ チャットで問い合わせる
    </button>
  </div>
  
  <div id="chatPopup">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
    <button onclick="goBack()">⬅ 戻る</button>
    <button onclick="closeChat()">❌ 閉じる</button>
  </div>
  <div id="chatBox"></div>
</div>
  
  <script>
    const buttons = document.querySelectorAll('#tab-buttons button');
    const sections = document.querySelectorAll('.content-section');
    const tabThemes = {
      news: 'theme-news',
      schedule: 'theme-schedule',
      players: 'theme-players',
      ticket: 'theme-ticket',
      stadium: 'theme-stadium',
      fan: 'theme-fan',
      academy: 'theme-academy',
      school: 'theme-school',
      town: 'theme-town',
      inquiry: 'theme-inquiry'
    };

    buttons.forEach(button => {
      button.addEventListener('click', () => {
        buttons.forEach(btn => btn.classList.remove('active'));
        sections.forEach(sec => sec.classList.remove('active'));

        const tab = button.dataset.tab;
        document.body.className = tabThemes[tab] || '';

        button.classList.add('active');
        document.getElementById(tab).classList.add('active');
      });
    });
document.addEventListener("DOMContentLoaded", () => {
  const img = document.getElementById("kaseno-img");
  const popup = document.getElementById("popup");
  let pressTimer;

  if (img && popup) {
    img.addEventListener("touchstart", (e) => {
      const rect = img.getBoundingClientRect();
      const touch = e.touches[0];
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;

      const inCenter = x > rect.width * 0.35 && x < rect.width * 0.65 && y > rect.height * 0.3 && y < rect.height * 0.7;
      if (!inCenter) return;

      pressTimer = setTimeout(() => {
        popup.style.display = "block";
        setTimeout(() => popup.style.display = "none", 2000);
      }, 600);
    });

    img.addEventListener("touchend", () => {
      clearTimeout(pressTimer);
    });
  }
});

 // --- チャット履歴
function updateFlags(currentKey) {
  const f = chatData._flags; // ← this._flags を chatData._flags に修正
  f.history.push(currentKey);
  if (f.history.length > 7) f.history.shift();

  const pattern = ["players", "back", "application", "schoolAcademySelection", "back", "schoolAcademySelection"];
  const actual = f.history.slice(-pattern.length);
  const matched = pattern.every((val, idx) => val === actual[idx]);

  if (matched) f.secretUnlocked = true;
}

   const chatData = {
      // --- 隠しルート
  _flags: {
    secretUnlocked: false,
    history: []
  },
     
  start: {
    text: "どんなお問い合わせですか？以下から選んでください：",
    options: [
      { label: "選手について", next: "players" },
      { label: "アクセス・場所について", next: "access" },
      { label: "イベント・楽しみ", next: "events" },
      { label: "クラブについて", next: "club" },
      { label: "申込について", next: "application" }
    ]
  },
  // --- Players
  players: {
    text: "選手についてご興味ありがとうございます。どういった情報をお求めですか？",
    options: [
      { label: "ポジション別で見る", next: "positions" },
      { label: "人気ランキング", next: "ranking" },
      { label: "引退選手紹介", next: "retired" }
    ]
  },
  positions: {
    text: "ポジションを選んでください：",
    options: [
      { label: "FW", next: "fwPlayers" },
      { label: "MF", next: "mfPlayers" },
      { label: "DF", next: "dfPlayers" },
      { label: "GK", next: "gkPlayers" }
    ]
  },
  fwPlayers: {
    text: "FWの注目選手：火星野つばさ。スピードと決定力に優れ、火星リーグ得点王の実績あり。",
    options: [
      { label: "インタビューを見る", next: "interview" }
    ]
  },
  mfPlayers: {
    text: "MFの注目選手：風間リク。宇宙一の展開力とボールキープ能力でゲームを支配。",
    options: []
  },
  dfPlayers: {
    text: "DFの注目選手：ミラ・タートル。鉄壁の守備とクールな判断でチームを支える。",
    options: []
  },
  gkPlayers: {
    text: "GKの注目選手：ユイ・スコーピオン。PKセーブ率100％の絶対的守護神。",
    options: []
  },
  interview: {
    text: "選手インタビュー：『勝利のためにすべてを懸ける。』彼らの情熱が伝わってきますね。",
    options: []
  },
  ranking: {
    text: "今週の人気選手ランキング：\n1位 火星野つばさ\n2位 ユイ・スコーピオン\n3位 風間リク",
    options: [
      { label: "応援メッセージを送る", next: "cheerMessage" }
    ]
  },
  cheerMessage: {
    text: "応援メッセージありがとうございます！選手に届くよう、心を込めて伝えます。これからも熱い応援をよろしくお願いします。",
    options: []
  },
  retired: {
    text: "引退選手紹介：\n・リオ・アルゴ：チーム初代キャプテン。\n・ナナ・ルシーダ：伝説のウインガー。\n彼らの功績を胸に、今の選手たちが戦っています。",
    options: []
  },

  // --- Access
  access: {
    text: "アクセスについてですね。どういった内容が気になりますか？",
    options: [
      { label: "アクセス手段", next: "transport" },
      { label: "現地設備", next: "facility" },
      { label: "アウェイ遠征案内", next: "away" }
    ]
  },
  transport: {
    text: "移動手段を選んでください：",
    options: [
      { label: "地下チューブ", next: "tubeAccess" },
      { label: "シャトルバス", next: "busAccess" }
    ]
  },
  tubeAccess: {
    text: "火星中央ステーションから地下チューブで15分。スムーズかつ快適な移動を提供します。",
    options: []
  },
  busAccess: {
    text: "市内からのシャトルバスも運行中。試合当日は臨時便も増発されます。",
    options: []
  },
  facility: {
    text: "施設のカテゴリを選んでください：",
    options: [
      { label: "売店／グッズ", next: "facilityShop" },
      { label: "トイレ／医務室", next: "facilityCare" }
    ]
  },
  facilityShop: {
    text: "グッズ売店では最新ユニフォームや限定グッズを販売中。試合前後の楽しみにどうぞ！",
    options: []
  },
  facilityCare: {
    text: "清潔なトイレ・応急医療室が完備されており、どなたでも安心してご利用いただけます。",
    options: []
  },
  away: {
    text: "遠征先を選んでください：",
    options: [
      { label: "火星南リーグエリア", next: "awaySouth" },
      { label: "外惑星リーグエリア", next: "awayOuter" }
    ]
  },
  awaySouth: {
    text: "南エリアでは火山地帯にあるアリーナが主戦場。迫力の試合と美しい景観を楽しめます。",
    options: []
  },
  awayOuter: {
    text: "外惑星リーグでは、土星の衛星チタンとの試合なども。超高重力環境下の激闘は必見です。",
    options: []
  },

  // --- Events
  events: {
    text: "イベント・楽しみ方について、以下からお選びください：",
    options: [
      { label: "今月のイベント情報", next: "monthlyEvents" },
      { label: "応援キャンペーン", next: "campaign" },
      { label: "ゲーム・占い・診断", next: "funTools" }
    ]
  },
  monthlyEvents: {
    text: "どのイベントに興味がありますか？",
    options: [
      { label: "選手握手会", next: "eventMeet" },
      { label: "花火フェス", next: "eventFireworks" }
    ]
  },
  eventMeet: {
    text: "握手会では選手とのふれあいだけでなく、写真撮影やサイン会も開催予定です。",
    options: []
  },
  eventFireworks: {
    text: "火星空に咲く花火フェス！音楽と光のショーで夏の夜を彩ります。",
    options: []
  },
  campaign: {
    text: "キャンペーン内容を選んでください：",
    options: [
      { label: "SNS投稿キャンペーン", next: "campaignSNS" },
      { label: "スタンプラリー", next: "campaignStamp" }
    ]
  },
  campaignSNS: {
    text: "『#火星野レオネッサ』をつけてSNSに投稿すると、抽選で限定グッズが当たります！",
    options: []
  },
  campaignStamp: {
    text: "スタジアム内5か所でスタンプを集めると、オリジナル缶バッジをプレゼント！",
    options: []
  },
  funTools: {
    text: "どの診断にチャレンジしますか？",
    options: [
      { label: "推し選手診断", next: "diagnosisPlayer" },
      { label: "火星適性テスト", next: "diagnosisMars" }
    ]
  },
  diagnosisPlayer: {
    text: "3問の質問に答えると、今のあなたにぴったりな選手が分かります！結果にご期待を。",
    options: []
  },
  diagnosisMars: {
    text: "火星生活への適性を診断します！あなたの未来が宇宙にあるかもしれません。",
    options: []
  },

  // --- Club
  club: {
    text: "クラブについて、気になる項目は？",
    options: [
      { label: "クラブの歴史", next: "history" },
      { label: "スタッフ紹介", next: "staff" },
      { label: "採用・ボランティア", next: "recruit" }
    ]
  },
  history: {
    text: "火星野レオネッサの歩み：2041年創設、2045年にリーグ昇格、2049年には火星カップ初優勝！",
    options: []
  },
  staff: {
    text: "監督：天城セイラ\nトレーナー：マックス井原\n運営統括：カワセ・ジョー",
    options: []
  },
  recruit: {
    text: "採用・ボランティア情報：情熱を持つあなたをお待ちしています。年齢・経験は不問です。",
    options: []
  },

  // --- Application
  application: {
    text: "申込についてですね。ご希望の内容をお選びください：",
    options: [
      { label: "チケット申込", next: "ticketType" },
      { label: "スクール／アカデミー申込", next: "schoolAcademySelection" },
      { label: "グッズ購入", next: "goodsCategory" },
      { label: "ファンクラブ入会", next: "fanclubType" }
    ]
  },
  
  // --- Ticket
  ticketType: {
    text: "ご希望のチケット種類を選んでください：",
    options: [
      { label: "自由席", next: "ticketFree" },
      { label: "指定席", next: "ticketReserved" },
      { label: "団体席", next: "ticketGroup" }
    ]
  },
  ticketFree: {
    text: "自由席：エリア内で自由に観戦可能です。お早めのご入場をおすすめします。",
    options: []
  },
  ticketReserved: {
    text: "指定席：座席を事前に確保できます。お好きなエリアを選んでください。",
    options: []
  },
  ticketGroup: {
    text: "団体席：10名以上のご利用でお得な割引あり。団体応援や遠征にも最適です。",
    options: []
  },

  // --- Goods
  goodsCategory: {
    text: "ご希望のグッズカテゴリを選んでください：",
    options: [
      { label: "ユニフォーム関連", next: "goodsUniform" },
      { label: "応援グッズ", next: "goodsSupport" },
      { label: "火星名物グッズ", next: "goodsSouvenir" }
    ]
  },
  goodsUniform: {
    text: "選手の背番号入りユニフォームは全サイズ対応。着るだけで気分も実力もアップ！？",
    options: []
  },
  goodsSupport: {
    text: "応援タオル、ホイッスル、光るスティックなど試合を熱く盛り上げるアイテムを多数用意！",
    options: []
  },
  goodsSouvenir: {
    text: "火星名物・赤土クッキーや重力ゼリーなど、地球では味わえない逸品をお土産にどうぞ！",
    options: []
  },

  // --- Fanclub
  fanclubType: {
    text: "入会ご希望のプランをお選びください：",
    options: [
      { label: "ライト会員", next: "fanclubLight" },
      { label: "スタンダード会員", next: "fanclubStandard" },
      { label: "VIP会員", next: "fanclubVIP" }
    ]
  },
  fanclubLight: {
    text: "ライト会員：入会金無料。試合速報や選手ブログなどの限定情報が読めるベーシックプランです。",
    options: []
  },
  fanclubStandard: {
    text: "スタンダード会員：試合後インタビュー動画、年1グッズプレゼントなど特典満載の中核プラン。",
    options: []
  },
  fanclubVIP: {
    text: "VIP会員：選手との交流会やプレミアムグッズなど夢のような特典が揃った特別プランです。",
    options: []
  },

  // --- School / Academy
  schoolAcademySelection: {
    text: "ご希望のコースと性別を選択してください：",
    get options() {
      const f = chatData._flags;
      const opts = [
        { label: "スクール（男子）", next: "schoolBoys" },
        { label: "アカデミー（女子）", next: "academyGirls" },
        { label: "アカデミー（男子）", next: "academyBoys" }
      ];
      if (f.secretUnlocked) {
        opts.unshift({ label: "スクール（女子）", next: "schoolGirls" });
      }
      return opts;
    }
  },
  schoolGirls: {
    text: "このスクールは、君をプロへと導くスタートラインだ……！\n\n夢を本気で掴みに来い。きらめく未来のピッチが、今ここから始まる。",
    options: [
      { label: "🌟 進む（スクール申込へ）", next: "lineGuide", style: "font-weight:bold; background: linear-gradient(to right, gold, orange); border-radius: 10px; padding: 0.5em 1em;" }
    ]
  },
  schoolBoys: {
    text: "君の挑戦が始まる。火星最高のコーチ陣とともに、基礎から応用まで全力でサポートします。",
    options: [
      { label: " 申込を進める", next: "lineGuide" }
    ]
  },
  academyGirls: {
    text: "アカデミー女子コースは、技術・戦術・人間力を磨く本格育成プログラム。新時代の主役は君だ。",
    options: [
      { label: " 申込を進める", next: "lineGuide" }
    ]
  },
  academyBoys: {
    text: "アカデミー男子コースは、火星代表を目指す精鋭の集い。高い志と挑戦心が未来を切り拓く。",
    options: [
      { label: " 申込を進める", next: "lineGuide" }
    ]
  },

  lineGuide: {
    text: "ありがとうございます！あなたの挑戦が始まります。担当者からのご連絡をお待ちください！",
    options: []
  }
};
  
function closeChat() {
  document.getElementById('chatPopup').style.display = 'none';

  // 状態を完全リセット
  currentNode = "start";
  chatHistory = [];
  chatData._flags = {
    secretUnlocked: false,
    history: []
  };
}

function startChat() {
  document.getElementById('chatPopup').style.display = 'block';
  showNode('start'); // ←フラグ・履歴を管理しつつ描画できる
}

function renderChat(stateKey) {
  const state = chatData[stateKey];
  const chatBox = document.getElementById('chatBox');

  let html = `
    <div class="chat-bubble bot">
      ${state.text.replace(/\n/g, '<br>')}
    </div>
  `;

  const options = typeof state.options === 'function' ? state.options() : state.options || [];

  for (const opt of options) {
    html += `
      <div class="chat-bubble user">
        <button onclick="showNode('${opt.next}')" style="${opt.style || ''}">${opt.label}</button>
      </div>
    `;
  }

  chatBox.innerHTML = html;
}

     // --- chat戻るボタン
let currentNode = "start"; // 初期化を必ず
let chatHistory = [];

function showNode(nodeKey) {
  const node = chatData[nodeKey];
  if (!node) return;

  // 履歴に保存（同じノードへの再表示は除外）
  if (currentNode && currentNode !== nodeKey) {
    chatHistory.push(currentNode);
  }

  // --- ① updateFlags() を先に実行
  updateFlags(nodeKey);

  // --- ② currentNode を更新
  currentNode = nodeKey;

  // --- ③ node.options を再取得するため、再代入が必要
  if (typeof node.options === "function") {
    node.options = node.options(); // ← この1行がキモ！
  }

  // --- ④ ノード内容を描画
  renderChat(nodeKey);
}



function goBack() {
  if (chatHistory.length === 0) return;

  const prev = chatHistory.pop();

  // フラグとして "back" も履歴に残す（隠しルート判定のため）
  updateFlags("back"); 

  showNode(prev);
}

  </script>
</body>
</html>
